<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <title>encrypt blog 2:12345</title>

  
    
 
     
     
     
  

  <link rel="shortcut icon" type="image/x-icon" href="/no-style-please/logo.png" />
  
  <style>body[a="dark"] {
  filter: invert(1); }
  body[a="dark"] img {
    filter: invert(1); }
    body[a="dark"] img.ioda {
      filter: invert(0); }

@media (prefers-color-scheme: dark) {
  body[a="auto"] {
    filter: invert(1); }
    body[a="auto"] img {
      filter: invert(1); }
      body[a="auto"] img.ioda {
        filter: invert(0); } }

html, body {
  background: white; }

html {
  height: 100%; }

body {
  color: black;
  font-family: 'Times New Roman', Times, serif;
  font-size: 16px;
  line-height: 1.6;
  margin: 0;
  min-height: 100%;
  overflow-wrap: break-word; }

.post-meta {
  text-align: right; }

h2, h3, h4, h5, h6 {
  margin-top: 3rem; }

hr {
  margin: 2rem 0; }

p {
  margin: 1rem 0; }

li {
  margin: 0.4rem 0; }

*:target {
  background: yellow; }

.w {
  max-width: 640px;
  margin: 0 auto;
  padding: 4rem 2rem; }

hr {
  text-align: center;
  border: 0; 
  font-family: serif;
}
  hr:before {
    content: '/////';
    font-family: monospace; }
  hr:after {
    content: attr(data-content) "/////";
    font-family: monospace; }

table {
  width: 100%; }

table, th, td {
  border: thin solid black;
  border-collapse: collapse;
  padding: 0.4rem; }

code {
  color: white;
  background: gray; }

div.highlighter-rouge code {
  display: block;
  overflow-x: auto;
  white-space: pre-wrap;
  padding: 1rem; }

blockquote {
  font-style: italic;
  border: thin solid black;
  padding: 1rem; }
  blockquote p {
    margin: 0; }

img {
  max-width: 100%;
  display: block;
  margin: 0 auto; }
</style>
  
  

</head><body a="auto">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/no-style-please/">..</a><article>
  <p class="post-meta">
    <time datetime="2022-05-16 19:00:58 +0800">2022-05-16</time>
  </p>
  
  <h1>encrypt blog 2:12345</h1>
  
  
      <a href="/no-style-please/tags/encrypt1.html"><text><nobr>#encrypt1</nobr></text>&nbsp;</a>
        
  
      <a href="/no-style-please/tags/blog.html"><text><nobr>#blog</nobr></text>&nbsp;</a>
        
  
      <a href="/no-style-please/tags/no-style-please2.html"><text><nobr>#no-style-please2</nobr></text>&nbsp;</a>
        </span>
<div id="encrypted">
    <h3> Content is Encryped :) </h3>
   
    <input style="width:100%; " type="password" id="passwordinput" placeholder="输入密码"></input>
    <p>
        <input type="button" value= "Decrypt" id="DecryptBtn"/>
        <input type="button" value= "Clear password cache" id="ClearBtn1"/>
    
    </div>
    
    <div id="decrypted"  style = "display:none">
        <p>
        <div>
           
            <input type="button" value= "Encrypt" id="EncryptBtn"/>

            <input type="button" value= "Clear password cache" id="ClearBtn2"/>
           
        </div>
        <div id = 'decryptContent'>
        </div>
    </div>
    <script>
        var exports = exports || {} 
    </script>
    <script src="//cdn.jsdelivr.net/gh/vitock/jsdelivr@0.1.2/js/base64js.js"></script>
    <script>
        !function(){

            const substl = crypto.subtle
            const preFix = 'ea1de90518f654cf7de2c008d4f20ff59';
            const encid = preFix
            const encryptedContent = 'E1.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'
            const base64str = encryptedContent.substring(3)
            const bfMsg = base64js.decode(base64str)
            const bfIv = bfMsg.subarray(0,12)
            const bfCipher = bfMsg.subarray(12)
            
            async function genKey(psw){
                var keyRaw = new TextEncoder().encode(psw)
                var key = await substl.importKey('raw',keyRaw,'PBKDF2',false,["deriveBits"])
                const salt = 'this is a salt string 20221019'
                let pbkdf2  = {
                    name:"PBKDF2",hash: "SHA-256",iterations: 12345,salt: new TextEncoder().encode(salt)
                }
                return  await substl.deriveBits(pbkdf2,key,256);
            }


 
        async function decrypt (key0,isCached){
            // const key = Uint8Array([...]); // 32 bytes key
            
            var key  = ''
            if(isCached){
                key = readKey()
            }
            else{
                var keyS = preFix + key0 +  preFix
                key = await genKey(keyS)
            }
            if (key.length == 0) {
                return
            }

            var aeskey = {
                name:"AES-GCM",
                length:256
            }
            var keyObj = await substl.importKey('raw',key,aeskey,false,['decrypt'])
            var aesDec= {name: "AES-GCM",iv:bfIv,tagLength:128}
            try {
                var bfDec  = await substl.decrypt(aesDec,keyObj,bfCipher)
                var plain = new TextDecoder().decode(bfDec);
                setKey(key)
                document.getElementById("encrypted").style.display = 'none'
                // / show decrypted 
    
                document.getElementById("decrypted").style.display = 'block'
                document.getElementById("decryptContent").innerHTML = plain
    
                setTimeout(function(){
                    var loadevent = document.createEvent("Event")
                    loadevent.initEvent("load", true, true)
    
                    var DOMContentLoaded_event = document.createEvent("Event")
                    DOMContentLoaded_event.initEvent("DOMContentLoaded", true, true)
    
                    window.dispatchEvent(loadevent)
                    window.dispatchEvent(DOMContentLoaded_event)
    
                }, 500);
            } catch (error) {
                alert("wrong password.")
            }
        }
        
        document.getElementById("DecryptBtn").onclick = function(){
            var key = document.getElementById("passwordinput").value
            decrypt(key);        
        }
    
        document.getElementById("EncryptBtn").onclick = function(){
            /// hide input
            document.getElementById("encrypted").style.display = 'block'
            // / show decrypted 
            document.getElementById("decrypted").style.display = "none"
    
            clearKey()
        }

        document.getElementById("EncryptBtn").onclick = function(){
            /// hide input
            document.getElementById("encrypted").style.display = 'block'
            // / show decrypted 
            document.getElementById("decrypted").style.display = "none"
    
            clearKey()
        }

        document.getElementById("ClearBtn1").onclick = function(){
            localStorage.clear();
        }
        document.getElementById("ClearBtn2").onclick = function(){
            localStorage.clear();
        }

        

        
    
        
            function readKey(){
                var key = encid;
                var v = localStorage.getItem(key)
                if (v) {
                    return base64js.decode(v)
                }else{
                    return null
                }
            }
            function setKey(value){
                var key = encid
                var arr = new Uint8Array(value)
                var b64 = base64js.encode(arr)
                return localStorage.setItem(key,b64)
            }
            function clearKey() {
                var key = encid
                localStorage.removeItem(key)
            }
            var cachekey = readKey()
            if(cachekey){
                decrypt(cachekey,true)
            }

        
        
        
 
    }()
    
    </script>
    
  
  
</article>

      </div>
    </main>
  </body>
</html>